if (response.ok && data.success) {
    const transactionData = data.data || data; // pode vir em data.data ou direto
    let qrCodeImage = null;
    let copyPaste = null;

    // Verifica se existe a estrutura aninhada "pix"
    if (transactionData.pix) {
        qrCodeImage = transactionData.pix.qrcode || transactionData.pix.qrCode || transactionData.pix.imagem;
        copyPaste = transactionData.pix.copy_paste || transactionData.pix.copia_e_cola || transactionData.pix.text;
    } else {
        // Se não, procura diretamente
        qrCodeImage = transactionData.qrcode || transactionData.qrCode;
        copyPaste = transactionData.copy_paste || transactionData.copia_e_cola || transactionData.pixCode;
    }

    // Exibe a imagem se encontrada
    if (qrCodeImage && qrCodeImage.startsWith('data:image')) {
        document.getElementById('qrcode').innerHTML = `<img src="${qrCodeImage}" alt="QR Code PIX">`;
    } else {
        // Se não tem imagem, mostra o texto no lugar do QR Code
        document.getElementById('qrcode').innerHTML = '<p style="color:white;">QR Code não disponível, use o código abaixo:</p>';
    }

    // Exibe o código copia e cola
    if (copyPaste) {
        document.getElementById('pixKey').innerText = copyPaste;
    } else if (qrCodeImage && !qrCodeImage.startsWith('data:image')) {
        // Se qrCodeImage for o código textual (caso do erro), usa ele
        document.getElementById('pixKey').innerText = qrCodeImage;
    }

    pixInfo.style.display = 'block';
    msgDiv.className = 'message success';
    msgDiv.innerText = 'Pagamento gerado! Escaneie ou copie o código.';
}
