<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dados - Nexus Trade</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header class="header">
        <div class="container header-content">
            <div class="logo">
                <img src="https://via.placeholder.com/120x40/1e293b/f5b342?text=NEXUS" alt="Nexus Trade">
                <span>NEXUS TRADE</span>
            </div>
            <nav class="nav-menu">
                <a href="/dashboard" class="nav-link"><i class="fas fa-home"></i> In√≠cio</a>
                <a href="/slot" class="nav-link"><i class="fas fa-dice"></i> Slots</a>
                <a href="/dice" class="nav-link active"><i class="fas fa-dice-d6"></i> Dados</a>
                <a href="/crash" class="nav-link"><i class="fas fa-plane"></i> Avi√£o</a>
                <a href="/roulette" class="nav-link"><i class="fas fa-circle"></i> Roleta</a>
                <a href="/blackjack" class="nav-link"><i class="fas fa-spade"></i> Blackjack</a>
                <a href="/affiliates" class="nav-link"><i class="fas fa-users"></i> Afiliados</a>
            </nav>
            <div class="user-area">
                <div class="balance-box" onclick="showDepositModal()">
                    <i class="fas fa-wallet balance-icon"></i>
                    <span class="balance-value" id="user-balance">R$ 0,00</span>
                </div>
                <div class="user-profile">
                    <div class="avatar" id="user-avatar">U</div>
                    <span class="user-name" id="user-name">Carregando</span>
                    <i class="fas fa-sign-out-alt logout-btn" onclick="logout()"></i>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="game-container">
            <h2 class="game-title">üé≤ DADOS</h2>

            <!-- Op√ß√µes de aposta -->
            <div class="dice-options">
                <button class="dice-option selected" onclick="selectDice('sum7')">Soma 7 (5x)</button>
                <button class="dice-option" onclick="selectDice('sum2')">Soma 2 (15x)</button>
                <button class="dice-option" onclick="selectDice('sum12')">Soma 12 (15x)</button>
                <button class="dice-option" onclick="selectDice('double')">Dupla (8x)</button>
                <button class="dice-option" onclick="selectDice('one')">N√∫mero 1 (6x)</button>
                <button class="dice-option" onclick="selectDice('six')">N√∫mero 6 (6x)</button>
            </div>

            <!-- Dados -->
            <div class="dice-container">
                <div class="dice" id="dice1">‚öÄ</div>
                <div class="dice" id="dice2">‚öÄ</div>
            </div>

            <!-- Controles de aposta -->
            <div class="bet-controls">
                <input type="number" id="dice-bet" class="bet-input" min="5" value="10" step="5">
                <button class="play-btn" onclick="playDice()">LAN√áAR</button>
            </div>

            <!-- Resultado -->
            <div id="dice-result" class="result-box hidden"></div>
        </div>
    </main>

    <!-- Modal QR Code (dep√≥sito) -->
    <div id="qr-modal" class="modal">
        <div class="modal-content">
            <button class="btn-close" onclick="closeModal()" style="position:absolute;top:10px;right:10px;background:none;border:none;color:white;font-size:24px;">√ó</button>
            <h2 style="color:var(--primary);">üí∞ DEP√ìSITO PIX</h2>
            <div class="quick-amounts">
                <button class="quick-amount-btn" onclick="setDepositAmount(20)">R$20</button>
                <button class="quick-amount-btn" onclick="setDepositAmount(30)">R$30</button>
                <button class="quick-amount-btn" onclick="setDepositAmount(50)">R$50</button>
                <button class="quick-amount-btn" onclick="setDepositAmount(100)">R$100</button>
                <button class="quick-amount-btn" onclick="setDepositAmount(200)">R$200</button>
                <button class="custom-amount-btn" onclick="setCustomAmount()">OUTRO</button>
            </div>
            <div id="custom-amount-container" style="display:none; margin-bottom:20px;">
                <input type="number" id="custom-amount" class="bet-input" placeholder="Digite o valor" min="20" step="5" style="width:100%;">
            </div>
            <img id="qr-code-img" class="qr-image" src="" alt="QR Code">
            <p id="pix-key-display" style="word-break:break-all; background:rgba(0,0,0,0.3); padding:10px; border-radius:5px;"></p>
            <div style="display:flex; gap:10px;">
                <button class="copy-btn" onclick="copyPixKey()"><i class="fas fa-copy"></i> COPIAR</button>
                <button class="copy-btn" onclick="confirmDepositRequest()" style="background:var(--success);"><i class="fas fa-check"></i> J√Å DEPOSITEI</button>
            </div>
        </div>
    </div>

    <div class="live-notifications" id="live-notifications"></div>

    <script src="script.js"></script>
    <script>
        let diceChoice = 'sum7';

        // Seleciona a op√ß√£o de dado
        function selectDice(opt) {
            document.querySelectorAll('.dice-option').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
            diceChoice = opt;
        }

        // Fun√ß√£o principal do jogo de dados
        async function playDice() {
            if (!userData) {
                alert('Usu√°rio n√£o carregado. Tente novamente.');
                return;
            }
            if (userData.status === 'Pendente' && !hasDeposited) {
                showDepositPopup('first-time');
                return;
            }
            if (userData.balance <= 0) {
                showDepositPopup('zero');
                return;
            }
            const bet = parseFloat(document.getElementById('dice-bet').value);
            if (bet > userData.balance) {
                showDepositPopup('zero');
                return;
            }
            if (bet < 5) {
                alert('Aposta m√≠nima: R$5');
                return;
            }

            // Determina o tipo de aposta baseado na escolha
            const betType = {
                type: diceChoice.startsWith('sum') ? 'sum' : (diceChoice === 'double' ? 'double' : 'specific'),
                value: diceChoice === 'sum7' ? 7 :
                       diceChoice === 'sum2' ? 2 :
                       diceChoice === 'sum12' ? 12 :
                       diceChoice === 'one' ? 1 :
                       diceChoice === 'six' ? 6 : 0
            };

            // Anima√ß√£o de rolagem
            document.getElementById('dice1').classList.add('rolling');
            document.getElementById('dice2').classList.add('rolling');

            try {
                const response = await fetch('/api/game/dice', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId: userData.id, betAmount: bet, betType })
                });
                const data = await response.json();

                if (response.ok) {
                    // Aguarda a anima√ß√£o terminar
                    setTimeout(() => {
                        document.getElementById('dice1').classList.remove('rolling');
                        document.getElementById('dice2').classList.remove('rolling');

                        const faces = ['‚öÄ', '‚öÅ', '‚öÇ', '‚öÉ', '‚öÑ', '‚öÖ'];
                        document.getElementById('dice1').textContent = faces[data.dice[0] - 1];
                        document.getElementById('dice2').textContent = faces[data.dice[1] - 1];

                        userData.balance = data.newBalance;
                        updateUI();

                        const resultDiv = document.getElementById('dice-result');
                        resultDiv.classList.remove('hidden', 'win', 'lose');
                        resultDiv.classList.add(data.win > 0 ? 'win' : 'lose');
                        resultDiv.innerHTML = data.message;
                    }, 800);
                } else {
                    alert('Erro: ' + (data.error || 'Desconhecido'));
                }
            } catch (error) {
                alert('Erro de conex√£o');
            }
        }

        // Inicializa os dados do usu√°rio
        loadUserData();
    </script>
</body>
</html>