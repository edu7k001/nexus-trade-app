<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Trade - Painel Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #f5b342;
            --primary-dark: #e09e2f;
            --secondary: #1a2639;
            --dark: #0b0f17;
            --dark-light: #1e293b;
            --light: #f8fafc;
            --gray: #94a3b8;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --gradient: linear-gradient(135deg, var(--primary), #f97316);
            --card-bg: rgba(30, 41, 59, 0.7);
            --border: rgba(255, 255, 255, 0.1);
            --shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--dark);
            color: var(--light);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: rgba(11, 15, 23, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            font-size: 32px;
            color: var(--primary);
        }

        .logo span {
            font-size: 24px;
            font-weight: 800;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--card-bg);
            padding: 6px 15px;
            border-radius: 50px;
            border: 1px solid var(--border);
        }

        .avatar {
            width: 36px;
            height: 36px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--dark);
        }

        .user-name {
            font-weight: 600;
        }

        .logout-btn {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 18px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .logout-btn:hover {
            color: var(--danger);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 25px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            color: var(--light);
        }

        .tab:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .tab.active {
            background: var(--primary);
            color: var(--dark);
            border-color: var(--primary);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 25px;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }

        .stat-title {
            color: var(--gray);
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-sub {
            color: var(--gray);
            font-size: 12px;
        }

        /* Tables */
        .table-container {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 15px;
            color: var(--primary);
            font-weight: 600;
            border-bottom: 2px solid var(--border);
        }

        td {
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pendente {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .status-aprovado {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .status-rejeitado {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .status-ativo {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .status-bloqueado {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .status-aguardando {
            background: rgba(59, 130, 246, 0.2);
            color: var(--info);
            border: 1px solid var(--info);
        }

        /* Buttons */
        .btn {
            padding: 8px 15px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--gradient);
            color: var(--dark);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 179, 66, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
        }

        .btn-warning {
            background: var(--warning);
            color: var(--dark);
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3);
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 11px;
        }

        .btn-group {
            display: flex;
            gap: 5px;
        }

        /* Search and Filters */
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            padding: 12px 20px;
            border-radius: 50px;
            border: 1px solid var(--border);
            background: rgba(0,0,0,0.3);
            color: white;
            font-size: 14px;
        }

        .filter-select {
            padding: 12px 20px;
            border-radius: 50px;
            border: 1px solid var(--border);
            background: rgba(0,0,0,0.3);
            color: white;
            font-size: 14px;
            min-width: 150px;
        }

        /* Config Grid */
        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .config-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 25px;
        }

        .config-card h3 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 18px;
        }

        .config-item {
            margin-bottom: 15px;
        }

        .config-item label {
            display: block;
            margin-bottom: 5px;
            color: var(--gray);
            font-size: 13px;
        }

        .config-item input, .config-item select {
            width: 100%;
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: rgba(0,0,0,0.3);
            color: white;
            font-size: 14px;
        }

        .config-item input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-bg);
            border: 2px solid var(--primary);
            border-radius: 30px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: var(--primary);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 24px;
            cursor: pointer;
        }

        .modal-close:hover {
            color: var(--danger);
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--gray);
        }

        .loading i {
            font-size: 40px;
            margin-bottom: 10px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Messages */
        .message {
            padding: 10px 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .message-success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .message-error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .tabs {
                justify-content: center;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .search-box {
                flex-direction: column;
            }
            
            .btn-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-crown"></i>
                <span>NEXUS TRADE ADMIN</span>
            </div>
            <div class="user-profile">
                <div class="avatar" id="user-avatar">A</div>
                <span class="user-name" id="user-name">Admin</span>
                <i class="fas fa-sign-out-alt logout-btn" onclick="logout()"></i>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
            <button class="tab" onclick="showTab('users')">üë• Usu√°rios</button>
            <button class="tab" onclick="showTab('deposits')">üí∞ Dep√≥sitos</button>
            <button class="tab" onclick="showTab('withdraws')">üí∏ Saques</button>
            <button class="tab" onclick="showTab('games')">üéÆ Jogos</button>
            <button class="tab" onclick="showTab('config')">‚öôÔ∏è Configura√ß√µes</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content">
            <div class="stats-grid" id="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-title">Usu√°rios Totais</div>
                    <div class="stat-value" id="stat-total-users">0</div>
                    <div class="stat-sub" id="stat-users-online">0 online</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Saldo Total</div>
                    <div class="stat-value" id="stat-total-balance">R$ 0</div>
                    <div class="stat-sub">Em todas as contas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Dep√≥sitos Pendentes</div>
                    <div class="stat-value" id="stat-pending-deposits">0</div>
                    <div class="stat-sub" id="stat-pending-deposits-amount">R$ 0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Saques Pendentes</div>
                    <div class="stat-value" id="stat-pending-withdraws">0</div>
                    <div class="stat-sub" id="stat-pending-withdraws-amount">R$ 0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Total de Apostas</div>
                    <div class="stat-value" id="stat-total-bets">R$ 0</div>
                    <div class="stat-sub" id="stat-total-wins">R$ 0 em ganhos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Receita</div>
                    <div class="stat-value" id="stat-revenue">R$ 0</div>
                    <div class="stat-sub">Lucro da casa</div>
                </div>
            </div>
        </div>

        <!-- Users Tab -->
        <div id="users-tab" class="tab-content" style="display: none;">
            <div class="search-box">
                <input type="text" class="search-input" id="user-search" placeholder="Buscar por nome, email ou PIX...">
                <select class="filter-select" id="user-status-filter">
                    <option value="todos">Todos os status</option>
                    <option value="Pendente">Pendente</option>
                    <option value="Ativo">Ativo</option>
                    <option value="Aguardando Dep√≥sito">Aguardando Dep√≥sito</option>
                    <option value="Pode Sacar">Pode Sacar</option>
                    <option value="Bloqueado">Bloqueado</option>
                </select>
                <button class="btn btn-primary" onclick="loadUsers()">üîç Buscar</button>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nome</th>
                            <th>Email</th>
                            <th>PIX</th>
                            <th>Saldo Real</th>
                            <th>Saldo B√¥nus</th>
                            <th>Total</th>
                            <th>Rollover</th>
                            <th>Meta</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="users-list">
                        <tr><td colspan="11" class="loading">Carregando...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Deposits Tab -->
        <div id="deposits-tab" class="tab-content" style="display: none;">
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Usu√°rio</th>
                            <th>Email</th>
                            <th>Valor</th>
                            <th>Data</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="deposits-list">
                        <tr><td colspan="6" class="loading">Carregando...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Withdraws Tab -->
        <div id="withdraws-tab" class="tab-content" style="display: none;">
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Usu√°rio</th>
                            <th>Email</th>
                            <th>Valor</th>
                            <th>CPF</th>
                            <th>Chave PIX</th>
                            <th>Data</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="withdraws-list">
                        <tr><td colspan="8" class="loading">Carregando...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Games Tab -->
        <div id="games-tab" class="tab-content" style="display: none;">
            <div class="search-box">
                <input type="text" class="search-input" id="game-search" placeholder="Buscar por usu√°rio...">
                <select class="filter-select" id="game-filter">
                    <option value="todos">Todos os jogos</option>
                    <option value="fortune-ox">Fortune Ox</option>
                    <option value="slot">Slots</option>
                    <option value="dice">Dados</option>
                </select>
                <button class="btn btn-primary" onclick="loadGameHistory()">üìú Ver Hist√≥rico</button>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Usu√°rio</th>
                            <th>Jogo</th>
                            <th>Aposta</th>
                            <th>Ganho</th>
                            <th>Resultado</th>
                            <th>Data</th>
                        </tr>
                    </thead>
                    <tbody id="games-list">
                        <tr><td colspan="7" class="loading">Carregando...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Config Tab -->
        <div id="config-tab" class="tab-content" style="display: none;">
            <div class="config-grid">
                <!-- Configura√ß√µes Gerais -->
                <div class="config-card">
                    <h3>üí∞ Configura√ß√µes Gerais</h3>
                    <div class="config-item">
                        <label>Chave PIX da Empresa</label>
                        <input type="text" id="config-pix-key" placeholder="Digite a chave PIX">
                    </div>
                    <div class="config-item">
                        <label>Modo Manuten√ß√£o</label>
                        <select id="config-maintenance">
                            <option value="0">Desativado</option>
                            <option value="1">Ativado</option>
                        </select>
                    </div>
                    <div class="config-item">
                        <label>Permitir Dep√≥sitos</label>
                        <select id="config-allow-deposits">
                            <option value="1">Sim</option>
                            <option value="0">N√£o</option>
                        </select>
                    </div>
                    <div class="config-item">
                        <label>Permitir Saques</label>
                        <select id="config-allow-withdrawals">
                            <option value="1">Sim</option>
                            <option value="0">N√£o</option>
                        </select>
                    </div>
                </div>

                <!-- Configura√ß√µes de Dep√≥sito/Saque -->
                <div class="config-card">
                    <h3>üíµ Dep√≥sitos e Saques</h3>
                    <div class="config-item">
                        <label>Dep√≥sito M√≠nimo (R$)</label>
                        <input type="number" id="config-min-deposit" step="0.01">
                    </div>
                    <div class="config-item">
                        <label>B√¥nus sobre Dep√≥sito (R$)</label>
                        <input type="number" id="config-bonus-amount" step="0.01">
                    </div>
                    <div class="config-item">
                        <label>Saque M√≠nimo (R$)</label>
                        <input type="number" id="config-min-withdraw" step="0.01">
                    </div>
                    <div class="config-item">
                        <label>Saque M√°ximo (R$)</label>
                        <input type="number" id="config-max-withdraw" step="0.01">
                    </div>
                    <div class="config-item">
                        <label>Taxa de Saque (%)</label>
                        <input type="number" id="config-withdraw-fee" step="0.1" min="0" max="100">
                    </div>
                </div>

                <!-- Sistema de Metas e B√¥nus -->
                <div class="config-card">
                    <h3>üéØ Metas e B√¥nus</h3>
                    <div class="config-item">
                        <label>B√¥nus Inicial (R$)</label>
                        <input type="number" id="config-initial-bonus" step="0.01">
                        <small style="color:var(--gray);">Cr√©dito ao cadastrar</small>
                    </div>
                    <div class="config-item">
                        <label>Meta Inicial (R$)</label>
                        <input type="number" id="config-initial-goal" step="0.01">
                        <small style="color:var(--gray);">Valor para liberar dep√≥sito</small>
                    </div>
                    <div class="config-item">
                        <label>Dep√≥sito Obrigat√≥rio (R$)</label>
                        <input type="number" id="config-required-deposit" step="0.01">
                    </div>
                    <div class="config-item">
                        <label>Meta P√≥s-Dep√≥sito (R$)</label>
                        <input type="number" id="config-post-deposit-goal" step="0.01">
                        <small style="color:var(--gray);">Valor para liberar saque</small>
                    </div>
                    <div class="config-item">
                        <label>Multiplicador de Rollover</label>
                        <input type="number" id="config-rollover-multiplier" step="0.1" min="1">
                        <small style="color:var(--gray);">Ex: 10x o b√¥nus</small>
                    </div>
                    <div class="config-item">
                        <label>Habilitar Rollover</label>
                        <select id="config-enable-rollover">
                            <option value="1">Sim</option>
                            <option value="0">N√£o</option>
                        </select>
                    </div>
                </div>

                <!-- Limites de Aposta -->
                <div class="config-card">
                    <h3>üé≤ Limites de Aposta</h3>
                    <div class="config-item">
                        <label>Fortune Ox (R$)</label>
                        <input type="number" id="config-fortune-ox-min-bet" step="0.01">
                    </div>
                    <div class="config-item">
                        <label>Slots (R$)</label>
                        <input type="number" id="config-slot-min-bet" step="0.01">
                    </div>
                    <div class="config-item">
                        <label>Dados (R$)</label>
                        <input type="number" id="config-dice-min-bet" step="0.01">
                    </div>
                    <div class="config-item">
                        <label>Crash (R$)</label>
                        <input type="number" id="config-crash-min-bet" step="0.01">
                    </div>
                    <div class="config-item">
                        <label>Roleta (R$)</label>
                        <input type="number" id="config-roulette-min-bet" step="0.01">
                    </div>
                    <div class="config-item">
                        <label>Blackjack (R$)</label>
                        <input type="number" id="config-blackjack-min-bet" step="0.01">
                    </div>
                </div>

                <!-- RTP dos Jogos -->
                <div class="config-card">
                    <h3>üìä RTP dos Jogos (%)</h3>
                    <div class="config-item">
                        <label>Fortune Ox</label>
                        <input type="number" id="config-fortune-ox-rtp" step="0.1" min="1" max="100">
                    </div>
                    <div class="config-item">
                        <label>Slots</label>
                        <input type="number" id="config-slot-rtp" step="0.1" min="1" max="100">
                    </div>
                    <div class="config-item">
                        <label>Dados</label>
                        <input type="number" id="config-dice-rtp" step="0.1" min="1" max="100">
                    </div>
                    <div class="config-item">
                        <label>Crash</label>
                        <input type="number" id="config-crash-rtp" step="0.1" min="1" max="100">
                    </div>
                    <div class="config-item">
                        <label>Roleta</label>
                        <input type="number" id="config-roulette-rtp" step="0.1" min="1" max="100">
                    </div>
                    <div class="config-item">
                        <label>Blackjack</label>
                        <input type="number" id="config-blackjack-rtp" step="0.1" min="1" max="100">
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 30px; text-align: center;">
                <button class="btn btn-primary" onclick="saveConfig()" style="padding: 15px 40px; font-size: 16px;">
                    <i class="fas fa-save"></i> SALVAR TODAS CONFIGURA√á√ïES
                </button>
            </div>
            <div id="config-message" style="margin-top: 20px;"></div>
        </div>
    </main>

    <!-- Modal de Edi√ß√£o de Usu√°rio -->
    <div id="user-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Usu√°rio</h2>
                <button class="modal-close" onclick="closeUserModal()">&times;</button>
            </div>
            <div id="user-form"></div>
        </div>
    </div>

    <!-- Modal de Confirma√ß√£o de Dep√≥sito -->
    <div id="deposit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Confirmar Dep√≥sito</h2>
                <button class="modal-close" onclick="closeDepositModal()">&times;</button>
            </div>
            <div id="deposit-form"></div>
        </div>
    </div>

    <script>
        // ==================== AUTENTICA√á√ÉO ====================
        let adminData = JSON.parse(localStorage.getItem('user') || '{}');
        
        if (!adminData.id || adminData.status !== 'Admin') {
            window.location.href = '/admin-login.html';
        }

        document.getElementById('user-name').textContent = adminData.name || 'Admin';
        document.getElementById('user-avatar').textContent = (adminData.name || 'A').charAt(0).toUpperCase();

        function getAuthHeader() {
            return 'Basic ' + btoa(`${adminData.email}:admin123`);
        }

        // ==================== UTILS ====================
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value || 0);
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleString('pt-BR');
        }

        function showMessage(container, message, type = 'success') {
            const msgDiv = document.getElementById(container);
            if (msgDiv) {
                msgDiv.innerHTML = `<div class="message message-${type}">${message}</div>`;
                setTimeout(() => msgDiv.innerHTML = '', 5000);
            }
        }

        // ==================== TAB NAVIGATION ====================
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
            
            document.querySelector(`.tab[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).style.display = 'block';
            
            // Carrega dados da aba
            switch(tabName) {
                case 'dashboard': loadDashboard(); break;
                case 'users': loadUsers(); break;
                case 'deposits': loadDeposits(); break;
                case 'withdraws': loadWithdraws(); break;
                case 'games': loadGameHistory(); break;
                case 'config': loadConfig(); break;
            }
        }

        // ==================== DASHBOARD ====================
        async function loadDashboard() {
            try {
                const res = await fetch('/api/admin/stats', { headers: { 'Authorization': getAuthHeader() } });
                const data = await res.json();
                
                document.getElementById('stat-total-users').textContent = data.total_users || 0;
                document.getElementById('stat-users-online').textContent = `${data.users_online || 0} online`;
                document.getElementById('stat-total-balance').textContent = formatCurrency(data.total_balance);
                document.getElementById('stat-pending-deposits').textContent = data.pending_deposits || 0;
                document.getElementById('stat-pending-deposits-amount').textContent = formatCurrency(data.pending_deposits_amount);
                document.getElementById('stat-pending-withdraws').textContent = data.pending_withdraws || 0;
                document.getElementById('stat-pending-withdraws-amount').textContent = formatCurrency(data.pending_withdraws_amount);
                document.getElementById('stat-total-bets').textContent = formatCurrency(data.total_bets);
                document.getElementById('stat-total-wins').textContent = formatCurrency(data.total_wins);
                
                const revenue = (data.total_bets || 0) - (data.total_wins || 0);
                document.getElementById('stat-revenue').textContent = formatCurrency(revenue);
            } catch (error) {
                console.error('Erro ao carregar dashboard:', error);
            }
        }

        // ==================== USU√ÅRIOS ====================
        async function loadUsers() {
            const tbody = document.getElementById('users-list');
            tbody.innerHTML = '<tr><td colspan="11" class="loading"><i class="fas fa-spinner"></i><br>Carregando...</td></tr>';
            
            const search = document.getElementById('user-search').value;
            const status = document.getElementById('user-status-filter').value;
            
            try {
                const res = await fetch(`/api/admin/users?search=${encodeURIComponent(search)}&status=${status}`, {
                    headers: { 'Authorization': getAuthHeader() }
                });
                const users = await res.json();
                
                if (users.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="11" style="text-align:center;">Nenhum usu√°rio encontrado</td></tr>';
                    return;
                }
                
                tbody.innerHTML = users.map(u => `
                    <tr>
                        <td>#${u.id}</td>
                        <td>${u.name || '-'}</td>
                        <td>${u.email}</td>
                        <td>${u.pix_key || '-'}</td>
                        <td>${formatCurrency(u.balance)}</td>
                        <td>${formatCurrency(u.bonus_balance)}</td>
                        <td><strong>${formatCurrency((u.balance || 0) + (u.bonus_balance || 0))}</strong></td>
                        <td>${formatCurrency(u.rollover_remaining)}</td>
                        <td>${u.meta_progress || 0}/${u.meta_atual === 1 ? document.getElementById('config-initial-goal')?.value || 100 : document.getElementById('config-post-deposit-goal')?.value || 500}</td>
                        <td><span class="status-badge status-${u.status.toLowerCase().replace(' ', '-')}">${u.status}</span></td>
                        <td>
                            <div class="btn-group">
                                <button class="btn btn-primary btn-sm" onclick="editUser(${u.id})">‚úèÔ∏è</button>
                                <button class="btn btn-warning btn-sm" onclick="adjustBalance(${u.id})">üí∞</button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                tbody.innerHTML = '<tr><td colspan="11" style="color:var(--danger);">Erro ao carregar usu√°rios</td></tr>';
            }
        }

        async function editUser(id) {
            try {
                const res = await fetch(`/api/admin/user/${id}`, { headers: { 'Authorization': getAuthHeader() } });
                const user = await res.json();
                
                const form = document.getElementById('user-form');
                form.innerHTML = `
                    <div class="config-item">
                        <label>Nome</label>
                        <input type="text" id="edit-name" value="${user.name || ''}">
                    </div>
                    <div class="config-item">
                        <label>Email</label>
                        <input type="email" id="edit-email" value="${user.email || ''}">
                    </div>
                    <div class="config-item">
                        <label>CPF</label>
                        <input type="text" id="edit-cpf" value="${user.cpf || ''}">
                    </div>
                    <div class="config-item">
                        <label>Telefone</label>
                        <input type="text" id="edit-phone" value="${user.phone || ''}">
                    </div>
                    <div class="config-item">
                        <label>Chave PIX</label>
                        <input type="text" id="edit-pix" value="${user.pix_key || ''}">
                    </div>
                    <div class="config-item">
                        <label>Saldo Real (R$)</label>
                        <input type="number" id="edit-balance" step="0.01" value="${user.balance || 0}">
                    </div>
                    <div class="config-item">
                        <label>Saldo B√¥nus (R$)</label>
                        <input type="number" id="edit-bonus-balance" step="0.01" value="${user.bonus_balance || 0}">
                    </div>
                    <div class="config-item">
                        <label>Rollover Restante (R$)</label>
                        <input type="number" id="edit-rollover" step="0.01" value="${user.rollover_remaining || 0}">
                    </div>
                    <div class="config-item">
                        <label>Status</label>
                        <select id="edit-status">
                            <option value="Pendente" ${user.status === 'Pendente' ? 'selected' : ''}>Pendente</option>
                            <option value="Ativo" ${user.status === 'Ativo' ? 'selected' : ''}>Ativo</option>
                            <option value="Aguardando Dep√≥sito" ${user.status === 'Aguardando Dep√≥sito' ? 'selected' : ''}>Aguardando Dep√≥sito</option>
                            <option value="Pode Sacar" ${user.status === 'Pode Sacar' ? 'selected' : ''}>Pode Sacar</option>
                            <option value="Bloqueado" ${user.status === 'Bloqueado' ? 'selected' : ''}>Bloqueado</option>
                        </select>
                    </div>
                    <div class="config-item">
                        <label>Meta Atual</label>
                        <select id="edit-meta">
                            <option value="1" ${user.meta_atual === 1 ? 'selected' : ''}>Meta Inicial</option>
                            <option value="2" ${user.meta_atual === 2 ? 'selected' : ''}>Meta P√≥s-Dep√≥sito</option>
                        </select>
                    </div>
                    <div class="config-item">
                        <label>Progresso da Meta (R$)</label>
                        <input type="number" id="edit-meta-progress" step="0.01" value="${user.meta_progress || 0}">
                    </div>
                    <button class="btn btn-primary" onclick="updateUser(${user.id})" style="width:100%; margin-top:20px;">
                        <i class="fas fa-save"></i> SALVAR
                    </button>
                `;
                
                document.getElementById('user-modal').style.display = 'block';
            } catch (error) {
                alert('Erro ao carregar usu√°rio: ' + error.message);
            }
        }

        async function updateUser(id) {
            const data = {
                name: document.getElementById('edit-name').value,
                email: document.getElementById('edit-email').value,
                cpf: document.getElementById('edit-cpf').value,
                phone: document.getElementById('edit-phone').value,
                pix_key: document.getElementById('edit-pix').value,
                balance: parseFloat(document.getElementById('edit-balance').value),
                bonus_balance: parseFloat(document.getElementById('edit-bonus-balance').value),
                rollover_remaining: parseFloat(document.getElementById('edit-rollover').value),
                status: document.getElementById('edit-status').value,
                meta_atual: parseInt(document.getElementById('edit-meta').value),
                meta_progress: parseFloat(document.getElementById('edit-meta-progress').value)
            };
            
            try {
                const res = await fetch(`/api/admin/user/${id}/update`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': getAuthHeader() },
                    body: JSON.stringify(data)
                });
                const result = await res.json();
                
                if (res.ok) {
                    alert('Usu√°rio atualizado!');
                    closeUserModal();
                    loadUsers();
                } else {
                    alert('Erro: ' + result.error);
                }
            } catch (error) {
                alert('Erro ao atualizar: ' + error.message);
            }
        }

        function closeUserModal() {
            document.getElementById('user-modal').style.display = 'none';
        }

        function adjustBalance(id) {
            editUser(id);
        }

        // ==================== DEP√ìSITOS ====================
        async function loadDeposits() {
            const tbody = document.getElementById('deposits-list');
            tbody.innerHTML = '<tr><td colspan="6" class="loading"><i class="fas fa-spinner"></i><br>Carregando...</td></tr>';
            
            try {
                const res = await fetch('/api/admin/deposits', { headers: { 'Authorization': getAuthHeader() } });
                const deposits = await res.json();
                
                if (deposits.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">Nenhum dep√≥sito pendente</td></tr>';
                    return;
                }
                
                tbody.innerHTML = deposits.map(d => `
                    <tr>
                        <td>#${d.id}</td>
                        <td>${d.name}</td>
                        <td>${d.email}</td>
                        <td><strong>${formatCurrency(d.amount)}</strong></td>
                        <td>${formatDate(d.created_at)}</td>
                        <td>
                            <div class="btn-group">
                                <button class="btn btn-success btn-sm" onclick="showConfirmDeposit(${d.id}, ${d.amount})">‚úÖ Confirmar</button>
                                <button class="btn btn-danger btn-sm" onclick="rejectDeposit(${d.id})">‚ùå Rejeitar</button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                tbody.innerHTML = '<tr><td colspan="6" style="color:var(--danger);">Erro ao carregar dep√≥sitos</td></tr>';
            }
        }

        function showConfirmDeposit(id, amount) {
            const form = document.getElementById('deposit-form');
            form.innerHTML = `
                <div class="config-item">
                    <label>Valor do Dep√≥sito (R$)</label>
                    <input type="number" id="deposit-amount" step="0.01" value="${amount}" readonly>
                </div>
                <div class="config-item">
                    <label>B√¥nus a Adicionar (R$)</label>
                    <input type="number" id="deposit-bonus" step="0.01" value="${document.getElementById('config-bonus-amount')?.value || 30}">
                </div>
                <p style="color:var(--gray); margin:10px 0;">Total a creditar: R$ <span id="deposit-total">${amount + (parseFloat(document.getElementById('config-bonus-amount')?.value || 30))}</span></p>
                <button class="btn btn-success" onclick="confirmDeposit(${id})" style="width:100%;">CONFIRMAR DEP√ìSITO</button>
            `;
            
            document.getElementById('deposit-amount').addEventListener('input', updateDepositTotal);
            document.getElementById('deposit-bonus').addEventListener('input', updateDepositTotal);
            
            document.getElementById('deposit-modal').style.display = 'block';
        }

        function updateDepositTotal() {
            const amount = parseFloat(document.getElementById('deposit-amount')?.value || 0);
            const bonus = parseFloat(document.getElementById('deposit-bonus')?.value || 0);
            document.getElementById('deposit-total').textContent = (amount + bonus).toFixed(2);
        }

        async function confirmDeposit(id) {
            const amount = parseFloat(document.getElementById('deposit-amount').value);
            const bonus = parseFloat(document.getElementById('deposit-bonus').value);
            
            try {
                const res = await fetch(`/api/admin/confirm-deposit/${id}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': getAuthHeader() },
                    body: JSON.stringify({ amount, bonus })
                });
                const result = await res.json();
                
                if (res.ok) {
                    alert(result.message);
                    closeDepositModal();
                    loadDeposits();
                } else {
                    alert('Erro: ' + result.error);
                }
            } catch (error) {
                alert('Erro ao confirmar: ' + error.message);
            }
        }

        async function rejectDeposit(id) {
            if (!confirm('Rejeitar este dep√≥sito?')) return;
            
            try {
                const res = await fetch(`/api/admin/reject-deposit/${id}`, {
                    method: 'POST',
                    headers: { 'Authorization': getAuthHeader() }
                });
                const result = await res.json();
                
                alert(result.message || 'Dep√≥sito rejeitado');
                loadDeposits();
            } catch (error) {
                alert('Erro: ' + error.message);
            }
        }

        function closeDepositModal() {
            document.getElementById('deposit-modal').style.display = 'none';
        }

        // ==================== SAQUES ====================
        async function loadWithdraws() {
            const tbody = document.getElementById('withdraws-list');
            tbody.innerHTML = '<tr><td colspan="8" class="loading"><i class="fas fa-spinner"></i><br>Carregando...</td></tr>';
            
            try {
                const res = await fetch('/api/admin/withdraws', { headers: { 'Authorization': getAuthHeader() } });
                const withdraws = await res.json();
                
                if (withdraws.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;">Nenhum saque pendente</td></tr>';
                    return;
                }
                
                tbody.innerHTML = withdraws.map(w => `
                    <tr>
                        <td>#${w.id}</td>
                        <td>${w.name}</td>
                        <td>${w.email}</td>
                        <td><strong>${formatCurrency(w.amount)}</strong></td>
                        <td>${w.cpf || '-'}</td>
                        <td>${w.pix_key || '-'}</td>
                        <td>${formatDate(w.created_at)}</td>
                        <td>
                            <div class="btn-group">
                                <button class="btn btn-success btn-sm" onclick="approveWithdraw(${w.id})">‚úÖ Aprovar</button>
                                <button class="btn btn-danger btn-sm" onclick="rejectWithdraw(${w.id})">‚ùå Rejeitar</button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                tbody.innerHTML = '<tr><td colspan="8" style="color:var(--danger);">Erro ao carregar saques</td></tr>';
            }
        }

        async function approveWithdraw(id) {
            if (!confirm('Aprovar este saque?')) return;
            
            try {
                const res = await fetch(`/api/admin/withdraw/${id}/approve`, {
                    method: 'POST',
                    headers: { 'Authorization': getAuthHeader() }
                });
                const result = await res.json();
                
                alert(result.message || 'Saque aprovado');
                loadWithdraws();
            } catch (error) {
                alert('Erro: ' + error.message);
            }
        }

        async function rejectWithdraw(id) {
            const reason = prompt('Motivo da rejei√ß√£o (opcional):');
            
            try {
                const res = await fetch(`/api/admin/withdraw/${id}/reject`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': getAuthHeader() },
                    body: JSON.stringify({ reason })
                });
                const result = await res.json();
                
                alert(result.message || 'Saque rejeitado');
                loadWithdraws();
            } catch (error) {
                alert('Erro: ' + error.message);
            }
        }

        // ==================== HIST√ìRICO DE JOGOS ====================
        async function loadGameHistory() {
            const tbody = document.getElementById('games-list');
            tbody.innerHTML = '<tr><td colspan="7" class="loading"><i class="fas fa-spinner"></i><br>Carregando...</td></tr>';
            
            try {
                const res = await fetch('/api/admin/game-history', { headers: { 'Authorization': getAuthHeader() } });
                const games = await res.json();
                
                if (games.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;">Nenhum hist√≥rico encontrado</td></tr>';
                    return;
                }
                
                tbody.innerHTML = games.map(g => `
                    <tr>
                        <td>#${g.id}</td>
                        <td>${g.name}</td>
                        <td>${g.game}</td>
                        <td>${formatCurrency(g.bet_amount)}</td>
                        <td>${formatCurrency(g.win_amount)}</td>
                        <td><span class="status-badge status-${g.result}">${g.result === 'win' ? 'Vit√≥ria' : 'Derrota'}</span></td>
                        <td>${formatDate(g.created_at)}</td>
                    </tr>
                `).join('');
            } catch (error) {
                tbody.innerHTML = '<tr><td colspan="7" style="color:var(--danger);">Erro ao carregar hist√≥rico</td></tr>';
            }
        }

        // ==================== CONFIGURA√á√ïES ====================
        async function loadConfig() {
            try {
                const res = await fetch('/api/admin/config', { headers: { 'Authorization': getAuthHeader() } });
                const config = await res.json();
                
                // Gerais
                document.getElementById('config-pix-key').value = config.pix_key || '';
                document.getElementById('config-maintenance').value = config.maintenance_mode || 0;
                document.getElementById('config-allow-deposits').value = config.allow_deposits || 1;
                document.getElementById('config-allow-withdrawals').value = config.allow_withdrawals || 1;
                
                // Dep√≥sitos/Saques
                document.getElementById('config-min-deposit').value = config.min_deposit || 20;
                document.getElementById('config-bonus-amount').value = config.bonus_amount || 30;
                document.getElementById('config-min-withdraw').value = config.min_withdraw || 150;
                document.getElementById('config-max-withdraw').value = config.max_withdraw || 5000;
                document.getElementById('config-withdraw-fee').value = config.withdraw_fee || 0;
                
                // Metas e B√¥nus
                document.getElementById('config-initial-bonus').value = config.initial_bonus || 20;
                document.getElementById('config-initial-goal').value = config.initial_goal || 100;
                document.getElementById('config-required-deposit').value = config.required_deposit || 50;
                document.getElementById('config-post-deposit-goal').value = config.post_deposit_goal || 500;
                document.getElementById('config-rollover-multiplier').value = config.rollover_multiplier || 10;
                document.getElementById('config-enable-rollover').value = config.enable_rollover || 1;
                
                // Limites de Aposta
                document.getElementById('config-fortune-ox-min-bet').value = config.fortune_ox_min_bet || 5;
                document.getElementById('config-slot-min-bet').value = config.slot_min_bet || 5;
                document.getElementById('config-dice-min-bet').value = config.dice_min_bet || 5;
                document.getElementById('config-crash-min-bet').value = config.crash_min_bet || 5;
                document.getElementById('config-roulette-min-bet').value = config.roulette_min_bet || 5;
                document.getElementById('config-blackjack-min-bet').value = config.blackjack_min_bet || 5;
                
                // RTP
                document.getElementById('config-fortune-ox-rtp').value = config.fortune_ox_rtp || 96.75;
                document.getElementById('config-slot-rtp').value = config.slot_rtp || 95;
                document.getElementById('config-dice-rtp').value = config.dice_rtp || 95;
                document.getElementById('config-crash-rtp').value = config.crash_rtp || 95;
                document.getElementById('config-roulette-rtp').value = config.roulette_rtp || 95;
                document.getElementById('config-blackjack-rtp').value = config.blackjack_rtp || 95;
                
            } catch (error) {
                showMessage('config-message', 'Erro ao carregar configura√ß√µes', 'error');
            }
        }

        async function saveConfig() {
            const config = {
                pix_key: document.getElementById('config-pix-key').value,
                maintenance_mode: parseInt(document.getElementById('config-maintenance').value),
                allow_deposits: parseInt(document.getElementById('config-allow-deposits').value),
                allow_withdrawals: parseInt(document.getElementById('config-allow-withdrawals').value),
                
                min_deposit: parseFloat(document.getElementById('config-min-deposit').value),
                bonus_amount: parseFloat(document.getElementById('config-bonus-amount').value),
                min_withdraw: parseFloat(document.getElementById('config-min-withdraw').value),
                max_withdraw: parseFloat(document.getElementById('config-max-withdraw').value),
                withdraw_fee: parseFloat(document.getElementById('config-withdraw-fee').value),
                
                initial_bonus: parseFloat(document.getElementById('config-initial-bonus').value),
                initial_goal: parseFloat(document.getElementById('config-initial-goal').value),
                required_deposit: parseFloat(document.getElementById('config-required-deposit').value),
                post_deposit_goal: parseFloat(document.getElementById('config-post-deposit-goal').value),
                rollover_multiplier: parseFloat(document.getElementById('config-rollover-multiplier').value),
                enable_rollover: parseInt(document.getElementById('config-enable-rollover').value),
                
                fortune_ox_min_bet: parseFloat(document.getElementById('config-fortune-ox-min-bet').value),
                slot_min_bet: parseFloat(document.getElementById('config-slot-min-bet').value),
                dice_min_bet: parseFloat(document.getElementById('config-dice-min-bet').value),
                crash_min_bet: parseFloat(document.getElementById('config-crash-min-bet').value),
                roulette_min_bet: parseFloat(document.getElementById('config-roulette-min-bet').value),
                blackjack_min_bet: parseFloat(document.getElementById('config-blackjack-min-bet').value),
                
                fortune_ox_rtp: parseFloat(document.getElementById('config-fortune-ox-rtp').value),
                slot_rtp: parseFloat(document.getElementById('config-slot-rtp').value),
                dice_rtp: parseFloat(document.getElementById('config-dice-rtp').value),
                crash_rtp: parseFloat(document.getElementById('config-crash-rtp').value),
                roulette_rtp: parseFloat(document.getElementById('config-roulette-rtp').value),
                blackjack_rtp: parseFloat(document.getElementById('config-blackjack-rtp').value)
            };
            
            try {
                const res = await fetch('/api/admin/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': getAuthHeader() },
                    body: JSON.stringify(config)
                });
                const result = await res.json();
                
                if (res.ok) {
                    showMessage('config-message', '‚úÖ Configura√ß√µes salvas com sucesso!', 'success');
                } else {
                    showMessage('config-message', '‚ùå ' + result.error, 'error');
                }
            } catch (error) {
                showMessage('config-message', '‚ùå Erro ao salvar: ' + error.message, 'error');
            }
        }

        // ==================== LOGOUT ====================
        function logout() {
            localStorage.removeItem('user');
            window.location.href = '/admin-login.html';
        }

        // ==================== INICIALIZA√á√ÉO ====================
        loadDashboard();
    </script>
</body>
</html>
