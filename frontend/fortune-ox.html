<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêÇ FORTUNE OX ‚Äì O JOGO DO TOURO</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #5a0c0c, #8b1a1a);
            color: #ffd700;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 30%, rgba(255,215,0,0.1) 0%, transparent 30%),
                        radial-gradient(circle at 80% 70%, rgba(255,215,0,0.1) 0%, transparent 30%),
                        repeating-linear-gradient(45deg, rgba(255,215,0,0.02) 0px, rgba(255,215,0,0.02) 2px, transparent 2px, transparent 10px);
            z-index: -1;
        }
        .game-container {
            max-width: 800px;
            width: 95%;
            background: rgba(20, 10, 10, 0.85);
            backdrop-filter: blur(5px);
            border: 3px solid #ffd700;
            border-radius: 40px;
            padding: 25px 20px;
            box-shadow: 0 30px 50px rgba(0,0,0,0.8), 0 0 0 2px #8b4513 inset;
            position: relative;
        }
        .game-container::before {
            content: '';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 30px;
            background: linear-gradient(to bottom, #ffd700, #b8860b);
            border-radius: 50% 50% 0 0;
            border: 2px solid #8b4513;
        }
        .game-container::after {
            content: 'Á¶è';
            position: absolute;
            top: -35px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            color: #ffd700;
            text-shadow: 2px 2px 0 #8b4513;
            font-weight: bold;
        }
        h1 {
            text-align: center;
            font-size: 42px;
            font-weight: 800;
            color: #ffd700;
            text-shadow: 4px 4px 0 #8b4513;
            margin-bottom: 5px;
        }
        .subtitle {
            text-align: center;
            color: #ffa500;
            font-size: 14px;
            margin-bottom: 20px;
            background: rgba(0,0,0,0.3);
            padding: 5px;
            border-radius: 50px;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }
        .info-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #2a1a1a, #1a0f0f);
            border: 2px solid #ffd700;
            border-radius: 60px;
            padding: 10px 20px;
            margin-bottom: 20px;
        }
        .balance-box {
            background: #000;
            padding: 8px 25px;
            border-radius: 40px;
            border: 2px solid #ffd700;
        }
        .balance-label {
            font-size: 12px;
            color: #ffa500;
        }
        .balance-value {
            font-size: 28px;
            font-weight: 700;
            color: #ffd700;
            line-height: 1;
        }
        .bet-control {
            display: flex;
            align-items: center;
            background: #000;
            border: 2px solid #ffd700;
            border-radius: 40px;
            overflow: hidden;
        }
        .bet-btn {
            width: 40px;
            height: 40px;
            background: #ffd700;
            color: #000;
            font-size: 20px;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: 0.2s;
        }
        .bet-btn:hover {
            background: #ffa500;
        }
        .bet-input {
            width: 80px;
            text-align: center;
            background: #000;
            color: #ffd700;
            font-size: 18px;
            font-weight: 600;
            border: none;
            outline: none;
        }
        .reels-area {
            background: linear-gradient(145deg, #2a1f1f, #1a1212);
            border: 4px solid #ffd700;
            border-radius: 40px;
            padding: 20px 10px;
            margin: 20px 0;
            position: relative;
        }
        .reels-row {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .reel-column {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100px;
        }
        .symbol-cell {
            height: 100px;
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border: 2px solid #ffd700;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            box-shadow: 0 5px 0 #8b4513;
            transition: 0.05s;
        }
        .symbol-cell.wild {
            background: #8b4513;
            border-color: #ffa500;
            box-shadow: 0 0 20px gold;
            font-size: 50px;
        }
        .reel-spinning .symbol-cell {
            animation: spinSymbol 0.08s infinite;
        }
        @keyframes spinSymbol {
            0% { transform: translateY(0); }
            100% { transform: translateY(8px); }
        }
        .paylines-overlay {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 40px);
            height: calc(100% - 40px);
            pointer-events: none;
        }
        .payline {
            position: absolute;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, transparent, gold, transparent);
            left: 0;
            opacity: 0.3;
            animation: pulse 2s infinite;
        }
        .payline-1 { top: 15%; }
        .payline-2 { top: 30%; }
        .payline-3 { top: 45%; }
        .payline-4 { top: 60%; }
        .payline-5 { top: 75%; }
        .payline-6 { top: 90%; }
        @keyframes pulse {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 0.6; }
        }
        .action-buttons {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        .spin-btn {
            background: linear-gradient(135deg, #ffd700, #ffa500);
            color: #000;
            border: none;
            border-radius: 60px;
            padding: 18px 60px;
            font-size: 28px;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 8px 0 #8b4513;
            transition: 0.1s;
        }
        .spin-btn:active {
            transform: translateY(8px);
            box-shadow: none;
        }
        .spin-btn:disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        .result-box {
            background: rgba(0,0,0,0.7);
            border: 2px solid gold;
            border-radius: 30px;
            padding: 15px;
            margin-top: 15px;
            text-align: center;
        }
        .win-amount {
            font-size: 32px;
            font-weight: 800;
            color: gold;
        }
        .win-detail {
            color: #ffa500;
            font-size: 14px;
        }
        .feature-indicator {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            border: 2px solid gold;
            border-radius: 40px;
            padding: 8px 20px;
            font-size: 16px;
            color: gold;
            animation: pulse 1s infinite;
            display: none;
        }
        .ox-character {
            position: absolute;
            bottom: 0;
            right: 20px;
            font-size: 80px;
            filter: drop-shadow(0 10px 10px rgba(0,0,0,0.5));
            animation: oxBounce 2s infinite;
            z-index: 10;
        }
        @keyframes oxBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .footer {
            text-align: center;
            margin-top: 20px;
            color: #ffa500;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="particles"></div>
    <div class="game-container">
        <h1>FORTUNE OX</h1>
        <div class="subtitle">üêÇ 10 LINHAS ‚Ä¢ RTP 96,75% ‚Ä¢ AT√â 2000x</div>
        <div class="info-bar">
            <div class="balance-box">
                <span class="balance-label">SALDO</span>
                <span class="balance-value" id="balance">R$ 1.000,00</span>
            </div>
            <div class="bet-control">
                <button class="bet-btn" onclick="changeBet(-5)">‚àí</button>
                <input type="text" id="betAmount" class="bet-input" value="10" readonly>
                <button class="bet-btn" onclick="changeBet(5)">+</button>
            </div>
        </div>

        <!-- Rolos 3-4-3 -->
        <div class="reels-area" id="reelsArea">
            <div class="reels-row">
                <div class="reel-column" id="col1"></div>
                <div class="reel-column" id="col2"></div>
                <div class="reel-column" id="col3"></div>
            </div>
            <div class="paylines-overlay">
                <div class="payline payline-1"></div>
                <div class="payline payline-2"></div>
                <div class="payline payline-3"></div>
                <div class="payline payline-4"></div>
                <div class="payline payline-5"></div>
                <div class="payline payline-6"></div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="spin-btn" id="spinBtn" onclick="spin()">GIRAR</button>
        </div>
        <div class="result-box" id="resultBox" style="display: none;">
            <div class="win-amount" id="winAmount">R$ 0,00</div>
            <div class="win-detail" id="winDetail"></div>
        </div>
        <div class="feature-indicator" id="featureIndicator">‚ú® RECURSO ATIVO ‚ú®</div>
        <div class="ox-character">üêÇ</div>
        <div class="footer">PG SOFT ‚Ä¢ 3 ROLOS ‚Ä¢ 10 LINHAS FIXAS</div>
    </div>

    <script>
        // ===== SISTEMA DE SOM CORRIGIDO (SEM ERRO DE STOP) =====
        let audioCtx = null;

        function playSound(type) {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
            const now = audioCtx.currentTime;

            if (type === 'spin') {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.type = 'sawtooth';
                osc.frequency.value = 200;
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                osc.frequency.exponentialRampToValueAtTime(50, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            } else if (type === 'win') {
                // Notas com pequenos atrasos para evitar conflito
                const notes = [523.25, 659.25, 783.99];
                notes.forEach((freq, i) => {
                    setTimeout(() => {
                        const osc = audioCtx.createOscillator();
                        const gain = audioCtx.createGain();
                        osc.connect(gain);
                        gain.connect(audioCtx.destination);
                        osc.type = 'sine';
                        osc.frequency.value = freq;
                        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                        osc.start();
                        osc.stop(audioCtx.currentTime + 0.3);
                    }, i * 100);
                });
                return;
            } else if (type === 'lose') {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.type = 'sawtooth';
                osc.frequency.value = 300;
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                osc.frequency.exponentialRampToValueAtTime(100, now + 0.2);
                osc.start(now);
                osc.stop(now + 0.2);
            } else if (type === 'feature') {
                const notes = [440, 554.37, 659.25];
                notes.forEach((freq, i) => {
                    setTimeout(() => {
                        const osc = audioCtx.createOscillator();
                        const gain = audioCtx.createGain();
                        osc.connect(gain);
                        gain.connect(audioCtx.destination);
                        osc.type = 'triangle';
                        osc.frequency.value = freq;
                        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                        osc.start();
                        osc.stop(audioCtx.currentTime + 0.2);
                    }, i * 70);
                });
                return;
            }
        }

        // ===== CONFIGURA√á√ÉO DO JOGO =====
        let balance = 1000.00;
        let currentBet = 10;
        let spinning = false;
        let featureActive = false;
        let timerRespin = null;

        // S√≠mbolos e pesos (RTP 96,75% simulado)
        const symbols = [
            { char: 'üêÇ', value: 200, weight: 5 },
            { char: 'ü™ô', value: 100, weight: 10 },
            { char: 'üßß', value: 50, weight: 15 },
            { char: 'üí∞', value: 20, weight: 20 },
            { char: 'üß®', value: 10, weight: 20 },
            { char: 'üçä', value: 5, weight: 15 },
            { char: 'üéÜ', value: 3, weight: 15 }
        ];
        const symbolChars = symbols.map(s => s.char);
        const totalWeight = symbols.reduce((acc, s) => acc + s.weight, 0);

        let col1 = [], col2 = [], col3 = [];

        function randomSymbol() {
            let r = Math.random() * totalWeight;
            let acc = 0;
            for (let s of symbols) {
                acc += s.weight;
                if (r < acc) return s.char;
            }
            return 'üéÜ';
        }

        function generateColumn(rows) {
            return Array.from({ length: rows }, () => randomSymbol());
        }

        function renderGrid() {
            const cols = [col1, col2, col3];
            for (let c = 0; c < 3; c++) {
                const colDiv = document.getElementById(`col${c+1}`);
                colDiv.innerHTML = '';
                for (let r = 0; r < cols[c].length; r++) {
                    const cell = document.createElement('div');
                    cell.className = 'symbol-cell';
                    if (cols[c][r] === 'üêÇ') cell.classList.add('wild');
                    cell.textContent = cols[c][r];
                    colDiv.appendChild(cell);
                }
            }
        }

        function updateBalanceDisplay() {
            document.getElementById('balance').textContent = `R$ ${balance.toFixed(2)}`;
        }

        function changeBet(delta) {
            if (spinning) return;
            currentBet = Math.max(5, Math.min(500, currentBet + delta));
            document.getElementById('betAmount').value = currentBet;
        }

        // ===== VERIFICA√á√ÉO DE GANHOS (10 LINHAS) =====
        function checkWins(col1, col2, col3, bet) {
            const grid = [
                [col1[0], col2[0], col3[0]],
                [col1[1], col2[1], col3[1]],
                [col1[2], col2[2], col3[2]],
                [null, col2[3], null]
            ];
            const lines = [
                [[0,0],[0,1],[0,2]],
                [[1,0],[1,1],[1,2]],
                [[2,0],[2,1],[2,2]],
                [[0,0],[1,1],[2,2]],
                [[2,0],[1,1],[0,2]],
                [[0,0],[2,1],[2,2]],
                [[2,0],[2,1],[0,2]],
                [[0,0],[3,1],[0,2]],
                [[2,0],[3,1],[2,2]],
                [[1,0],[2,1],[1,2]]
            ];
            let totalWin = 0;
            let messages = [];
            for (let line of lines) {
                const syms = line.map(p => grid[p[0]][p[1]]).filter(s => s);
                if (syms.length < 3) continue;
                const first = syms[0];
                const isWild = first === 'üêÇ';
                const nonWild = syms.filter(s => s !== 'üêÇ');
                if (isWild) {
                    if (nonWild.length === 0) {
                        totalWin += bet * 200;
                        messages.push('3x üêÇ (200x)');
                    } else if (nonWild.length === 2 && nonWild[0] === nonWild[1]) {
                        const mult = symbols.find(s => s.char === nonWild[0])?.value || 0;
                        totalWin += bet * mult;
                        messages.push(`üêÇüêÇ + ${nonWild[0]} (${mult}x)`);
                    } else if (nonWild.length === 1 && syms.filter(s => s === nonWild[0]).length === 2) {
                        const mult = symbols.find(s => s.char === nonWild[0])?.value || 0;
                        totalWin += bet * mult;
                        messages.push(`üêÇ + 2x ${nonWild[0]} (${mult}x)`);
                    }
                } else {
                    if (syms.every(s => s === first || s === 'üêÇ')) {
                        const mult = symbols.find(s => s.char === first)?.value || 0;
                        totalWin += bet * mult;
                        messages.push(`3x ${first} (${mult}x)`);
                    }
                }
            }
            return { totalWin, messages };
        }

        // ===== RECURSO RESPIN =====
        async function activateRespin(fixedCol1, fixedCol3) {
            featureActive = true;
            document.getElementById('featureIndicator').style.display = 'block';
            playSound('feature');

            let newCol2 = generateColumn(4);
            let attempt = 0;
            const maxAttempts = 20;

            while (attempt < maxAttempts) {
                renderGrid(); // atualiza com os rolos atuais (fixos + novo)
                document.querySelectorAll('.reel-column')[1].classList.add('reel-spinning');
                await new Promise(r => setTimeout(r, 150));
                document.querySelectorAll('.reel-column')[1].classList.remove('reel-spinning');

                const win = checkWins(fixedCol1, newCol2, fixedCol3, currentBet).totalWin;
                if (win > 0) {
                    featureActive = false;
                    document.getElementById('featureIndicator').style.display = 'none';
                    return newCol2;
                }
                newCol2 = generateColumn(4);
                attempt++;
            }
            featureActive = false;
            document.getElementById('featureIndicator').style.display = 'none';
            return newCol2;
        }

        // ===== FUN√á√ÉO PRINCIPAL DE GIRAR =====
        async function spin() {
            if (spinning || featureActive) return;
            if (balance < currentBet) {
                alert('Saldo insuficiente!');
                return;
            }

            spinning = true;
            document.getElementById('spinBtn').disabled = true;
            playSound('spin');

            balance -= currentBet;
            updateBalanceDisplay();
            document.getElementById('resultBox').style.display = 'none';

            col1 = generateColumn(3);
            col2 = generateColumn(4);
            col3 = generateColumn(3);

            document.querySelectorAll('.reel-column').forEach(el => el.classList.add('reel-spinning'));
            await new Promise(r => setTimeout(r, 800));
            document.querySelectorAll('.reel-column').forEach(el => el.classList.remove('reel-spinning'));

            const hasWild = col1.includes('üêÇ') || col2.includes('üêÇ') || col3.includes('üêÇ');
            if (hasWild && !featureActive) {
                col2 = await activateRespin(col1, col3);
            }

            renderGrid();

            const allSymbols = [...col1, ...col2, ...col3];
            const isFullScreen = allSymbols.every(s => s === allSymbols[0] || s === 'üêÇ');
            let multiplier = 1;
            if (isFullScreen) multiplier = 10;

            const win = checkWins(col1, col2, col3, currentBet);
            const totalWin = win.totalWin * multiplier;

            if (totalWin > 0) {
                balance += totalWin;
                updateBalanceDisplay();
                playSound('win');

                let msg = win.messages.join('<br>');
                if (multiplier > 1) msg += '<br>‚ú® TELA CHEIA x10 ‚ú®';
                document.getElementById('winAmount').textContent = `R$ ${totalWin.toFixed(2)}`;
                document.getElementById('winDetail').innerHTML = msg;
                document.getElementById('resultBox').style.display = 'block';
            } else {
                playSound('lose');
            }

            spinning = false;
            document.getElementById('spinBtn').disabled = false;
        }

        // ===== INICIALIZA√á√ÉO =====
        col1 = generateColumn(3);
        col2 = generateColumn(4);
        col3 = generateColumn(3);
        renderGrid();
        updateBalanceDisplay();
    </script>
</body>
</html>